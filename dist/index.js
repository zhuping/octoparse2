"use strict";function makeMap(t,e){for(var a=Object.create(null),n=t.split(","),r=0;r<n.length;r++)a[n[r]]=!0;return e?function(t){return a[t.toLowerCase()]}:function(t){return a[t]}}var isUnaryTag=makeMap("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"),isPlainTextElement=makeMap("script,style,textarea",!0),isIgnoreNewlineTag=makeMap("pre,textarea",!0),attribute=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,ncname="[a-zA-Z_][\\-\\.0-9_a-zA-Z]*",qnameCapture="((?:".concat(ncname,"\\:)?").concat(ncname,")"),startTagOpen=new RegExp("^<".concat(qnameCapture)),startTagClose=/^\s*(\/?)>/,endTag=new RegExp("^<\\/".concat(qnameCapture,"[^>]*>")),doctype=/^<!DOCTYPE [^>]+>/i,comment=/^<!\--/,conditionalComment=/^<!\[/,decodingMap={"&lt;":"<","&gt;":">","&quot;":'"',"&amp;":"&","&#10;":"\n","&#9;":"\t","&#39;":"'"},encodedAttr=/&(?:lt|gt|quot|amp|#39);/g,encodedAttrWithNewLines=/&(?:lt|gt|quot|amp|#39|#10|#9);/g,shouldIgnoreFirstNewline=function(t,e){return t&&isIgnoreNewlineTag(t)&&"\n"===e[0]};function decodeAttr(t,e){var a=e?encodedAttrWithNewLines:encodedAttr;return t.replace(a,function(t){return decodingMap[t]})}function parseHTML(r,c){for(var t,l,d=[],s=0;r;){if(t=r,!l||!isPlainTextElement(l)){var e=r.indexOf("<");if(0===e){if(comment.test(r)){var a=r.indexOf("--\x3e");if(0<=a){f(a+3);continue}}if(conditionalComment.test(r)){var n=r.indexOf("]>");if(0<=n){f(n+2);continue}}var i=r.match(doctype);if(i){f(i[0].length);continue}var o=r.match(endTag);if(o){var g=s;f(o[0].length),T(o[1],g,s);continue}var h=v();if(h){w(h),shouldIgnoreFirstNewline(h.tagName,r)&&f(1);continue}}var u=void 0,m=void 0,p=void 0;if(0<=e){for(m=r.slice(e);!(endTag.test(m)||startTagOpen.test(m)||comment.test(m)||conditionalComment.test(m)||(p=m.indexOf("<",1))<0);)e+=p,m=r.slice(e);u=r.substring(0,e)}e<0&&(u=r),u&&f(u.length),c.chars&&u&&c.chars(u,s-u.length,s)}if(r===t){c.chars&&c.chars(r),d.length||console.warn('Mal-formatted tag at end of template: "'.concat(r,'"'),{start:s+r.length});break}}function f(t){s+=t,r=r.substring(t)}function v(){var t=r.match(startTagOpen);if(t){var e,a,n={tagName:t[1],attrs:[],start:s};for(f(t[0].length);!(e=r.match(startTagClose))&&(a=r.match(attribute));)a.start=s,f(a[0].length),a.end=s,n.attrs.push(a);if(e)return n.unarySlash=e[1],f(e[0].length),n.end=s,n}}function w(t){for(var e=t.tagName,a=!!t.unarySlash,n=t.attrs.length,r=new Array(n),i=0;i<n;i++){var s=t.attrs[i],o=s[3]||s[4]||s[5]||"";r[i]={name:s[1],value:decodeAttr(o,!0)}}a||(d.push({tag:e,lowerCasedTag:e.toLowerCase(),attrs:r,start:t.start,end:t.end}),l=e),c.start&&c.start(e,r,a,t.start,t.end)}function T(t,e,a){var n,r;if(null==e&&(e=s),null==a&&(a=s),t)for(r=t.toLowerCase(),n=d.length-1;0<=n&&d[n].lowerCasedTag!==r;n--);else n=0;if(0<=n){for(var i=d.length-1;n<=i;i--)(n<i||!t)&&console.warn("tag <".concat(d[i].tag,"> has no matching end tag.")),c.end&&c.end(d[i].tag,e,a);d.length=n,l=n&&d[n-1].tag}else"br"===r?c.start&&c.start(t,[],!0,e,a):"p"===r&&(c.start&&c.start(t,[],!1,e,a),c.end&&c.end(t,e,a))}T()}function parse(t){var i=[],s={node:"root",children:[]};return parseHTML(t.replace(/\r?\n+/g,"").replace(/\/\*.*?\*\//gi,"").replace(/&nbsp;/g,"Â ").replace(/[ ]+</gi,"<"),{start:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],a=2<arguments.length?arguments[2]:void 0,n={type:"node",name:t};if(n.attrs=makeAttrsMap(e),n.attrs.style="margin:0;padding:0;".concat(n.attrs.style||""),"img"===t&&(n.attrs.style="max-width:100%;height:auto;vertical-align:top;".concat(n.attrs.style||"")),a){var r=i[0]||s;void 0===r.children&&(r.children=[]),r.children.push(n)}else i.unshift(n)},end:function(t){var e=i.shift();if(e.name!==t&&console.warn("invalid state: mismatch end tag."),0===i.length)s.children.push(e);else{var a=i[0];void 0===a.children&&(a.children=[]),a.children.push(e)}},chars:function(t){var e={type:"text",text:t};if(0===i.length)s.children.push(e);else{var a=i[0];void 0===a.children&&(a.children=[]),a.children.push(e)}}}),s.children}function makeAttrsMap(t){for(var e={},a=0,n=t.length;a<n;a++)e[t[a].name]&&console.warn("duplicate attribute: "+t[a].name,t[a]),e[t[a].name]=t[a].value;return e}var octoparse={parse:parse};module.exports=octoparse;
